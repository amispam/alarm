<!DOCTYPE html>
<html>
    <head>
        <title>Smart timer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
    background:black;
    color:lightgreen;
}
input{
    background:rgba(100,100,100,0.1);
    color:yellow;
    border:none;
    padding:2vw;
    font-weight:bold;
    font-size:7vw;
    width:30vw;
    border-radius:1vw;
}
button{
    background:steelblue;
    color:black;
    border:1px solid red;
    padding:2vw;
    font-weight:bold;
    font-size:7vw;
    border-radius:2vw;
}
#stop{
    background:yellow;
    color:red;
    border:1px solid red;
    padding:2vw;
    font-weight:bold;
    font-size:7vw;
    border-radius:2vw;
}


nav{
    color:gray;
    padding:2vw;
    background:rgba(0,150,200,0.1);
    font-weight:bold;
    font-size:9vw;
}
#di1{
    background:rgba(0,150,200,0.1);
    padding:5vw;
    border-radius:3vw;
}
    </style>
    </head>
    <body>
    <center>
    <nav>Timer with Alarm</nav><hr><br />
    <div id="di1">
    <input type="number" id="min" placeholder="minutes..." value="0" style="display:flex; text-align:center;" autofocus /><br /><br />
    <input type="number" id="sec" placeholder="seconds..." value="5" style="display:flex; text-align:center;" /><br /><br />
    <button>Set Timer</button>
    </div>
    <div id="di2">
    </div>
    <meter min="0" max="100" low="20" high="50" optimum="80" value="100" id="mtr" style="width:50vw; background:black;"></meter><br /><br />
    <input type="button" value="stop" id="stop" />
    <pre style="width:90vw; overflow:auto; padding:2vw; background:rgba(100,100,100,0.1); color:orange; font-size:3vw;"><marquee>Make sure that your device is not in silent mode, otherwise you would not be able to hear sound of the alarm...</marquee></pre>
    </center>
    <br /><br /><br /><br />
        <script>
           const di1 = document.querySelector("#di1");
           const di2 = document.querySelector("#di2");
           const min = document.querySelector("#min");
           const sec = document.querySelector("#sec");
           const btn = document.querySelector("button");
           const stop = document.querySelector("#stop");
           stop.style.display = "none";
           const mtr = document.querySelector("#mtr");
           mtr.style.display = "none";
           btn.addEventListener("click",()=>{
               if((min.value != null && sec.value != null) && (min.value == parseInt(min.value) && sec.value == parseInt(sec.value)) && (sec.value > 0 || min.value > 0)){
                   di1.style.display = "none";
                   min.innerHTML = "";
                   sec.innerHTML = "";
                   di2.style.display = "block";
                   var z = -100;
                   var total = (parseInt(sec.value)+parseInt(min.value*60));
                   const rslt = total;
                   var ttl = rslt;
                   
      
            mtr.style.display = " block";
            function meter(){
            if(ttl>=0){  
            ttl = ((rslt-(z/100))/rslt)*100;
            mtr.value = ttl;
            z++;
            if(mtr.value == 0){
                clearInterval(mtr1);
            }
                }
            }
                     var mtr1 = setInterval(meter,10);
      
           
                   
                   var timer = setInterval(()=>{
              if(total >= 0) {
                    di2.innerHTML = "<h1>"+status(parseInt(total))+"</h1>";
                    
              if(total === 0){
            stop.style.display = "block";
            mtr.style.display = "none";
            window.AudioContext = window.AudioContext || window.webkitAudioContext;
            var audio = new AudioContext();
            var osc = audio.createOscillator();
            osc.connect(audio.destination);
            var i = 0;
            var beep = setInterval(()=>{
            i++;
            if(i%2==0){
            osc.type = "square";
            }
            if(i%2 == 1){
                osc.type = "triangle";
            }
            },300)
            osc.start();
            clearInterval(timer);
            stop.addEventListener("click", ()=>{
                stop.style.display = "none";
                clearInterval("beep");
                osc.stop();
                di2.style.display = "none";
                di2.innerHTML = "";
                di1.style.display = "block";
            });
                  }
                  }
                  total--;
                   },1000);
        
                   
               }
               else{
                   console.log("Error...");
               }
           });
           
           function status(num){
               var minNum = parseInt(num/60);
               var secNum = parseInt(num)-(minNum*60);
               if(minNum < 10){
                   minNum = "0"+minNum;
               }
               if(secNum < 10){
                   secNum = "0"+secNum;
               }
               return minNum+":"+secNum;
           }
           
        </script>
    </body>
</html>
